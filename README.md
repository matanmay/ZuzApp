# ZuzApp - Movement Logger & Experiment Tracker üì±üìä

**ZuzApp** is an Android application designed for scientific experiments and movement tracking. It captures real-time gyroscope data, filters sensor noise through calibration, and logs movement magnitude to both a local CSV file and a remote **Supabase** backend.

## üöÄ Features

* **Real-time Sensor Monitoring**: Tracks device rotation using the Gyroscope sensor.
* **Intelligent Calibration**:
    * Calculates baseline noise when the device is stationary upon startup.
    * Applies a noise threshold to ensure only significant movements are recorded.
* **Dual Logging System**:
    * **Local**: Saves data to CSV files in the format `Subject__Session__Timestamp.csv` stored in internal storage.
    * **Cloud**: Syncs session metadata and movement records to Supabase.
* **Optimized Performance**:
    * Uploads movement records in batches (size 20) to reduce network overhead.
    * Keeps the screen active during recording to prevent sensor dozing.
* **Session Management**: Supports manual Session IDs or auto-generates UUIDs.

---

## üõ† Installation & Setup

### 1. Prerequisites
* Android Studio.
* A Supabase project.

### 2. Configure Supabase Credentials
The `SupabaseClient.java` relies on a `Config` class to fetch credentials. This file is **required** for the app to build.

Create a new file `Config.java` in the package `com.haifa.zuzapp`:

```java
package com.haifa.zuzapp;

public class Config {
    // Replace with your actual Supabase Project URL and Anon Key
    private static final String SUPABASE_URL = "[https://your-project-id.supabase.co](https://your-project-id.supabase.co)";
    private static final String SUPABASE_ANON_KEY = "your-public-anon-key";

    public static String getSupabaseUrl() {
        return SUPABASE_URL;
    }

    public static String getSupabaseAnonKey() {
        return SUPABASE_ANON_KEY;
    }
}

```

### 3. Database Schema

You must create two tables in your Supabase project to match the JSON objects constructed in `SupabaseClient.java`. Run the following SQL in your Supabase SQL Editor:

```sql
-- Table: sessions
create table public.sessions (
  session_id text not null,
  experimenter_code text not null,
  start_time text,
  start_time_millis bigint,
  end_time text,
  end_time_millis bigint,
  duration_ms bigint,
  status text, -- 'started' or 'completed'
  device_model text,
  android_version text,
  file_path text,
  primary key (session_id, experimenter_code)
);

-- Table: movement_records
create table public.movement_records (
  id bigint generated by default as identity primary key,
  session_id text not null,
  experimenter_code text not null,
  timestamp text, -- Stores time as HH:mm:ss.SSS
  elapsed_time_ms bigint,
  magnitude float
);

```

## üìñ Usage Guide

1. **Calibration (Auto-start)**:
* Upon opening the app, it attempts to calibrate the gyroscope.
* **Keep the device perfectly still** until the status text turns green and says "Calibrated!".
* *Note: You cannot start a session without calibration.*


2. **Setup Session**:
* **Experimenter Code**: Enter the subject name or researcher code (Required).
* **Session ID**: Leave blank to auto-generate a generic UUID, or type a specific ID.


3. **Recording**:
* Press **START SESSION**.
* Perform the movement tasks. The screen shows the current Gyro Delta (Degrees/second).
* Data is saved locally and uploaded to the cloud in batches.


4. **Stopping**:
* Press **STOP SESSION**.
* The app finalizes the CSV file and updates the session end time/duration in the database.



---

## üìÇ Data Output Format

### Local CSV

Files are stored in the app's private files directory.
**Format:**

```csv
SessionID,ExperimenterCode,Timestamp,ElapsedTimeMs,Magnitude
uuid-1234,SUBJ_01,14:30:01.050,50,12.45
...

```

### Sensor Math

The app calculates the **Total Velocity Magnitude** from the Gyroscope (x, y, z):

1. **Calculate Magnitude (Radians):** 
2. **Convert to Degrees:** 
3. **Baseline Subtraction:** 
4. **Thresholding:** If , record as .

---

## üèó Architecture

* **MainActivity**: Handles UI, `SensorEventListener`, and Calibration logic.
* **MovementLogger**: Manages the local `FileWriter` and buffers data for the network.
* **SupabaseClient**: Handles REST API calls (POST/PATCH) using `HttpURLConnection` and a background `ExecutorService`.
